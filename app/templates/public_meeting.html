{% extends 'base.html' %}
{% block content %}
<h1 class="font-bold text-bp-blue mb-2">{{ meeting.title }}</h1>
<p class="mb-4">Stage: {{ meeting.status or 'Draft' }} | Members: {{ member_count }}</p>
{% if meeting.opens_at_stage1 and meeting.closes_at_stage1 %}
<p class="mb-2">
  Stage 1:
  {{ meeting.opens_at_stage1|format_dt }} –
  {{ meeting.closes_at_stage1|format_dt }}
  <a href="{{ stage1_ics_url }}" class="text-bp-blue hover:underline ml-2" download>Add to calendar</a>
</p>
<div class="mb-4">
  <div id="stage1-progress" class="bp-progress" data-progress-open="{{ meeting.opens_at_stage1.isoformat() }}Z" data-progress-close="{{ meeting.closes_at_stage1.isoformat() }}Z" role="progressbar" aria-valuemin="0" aria-valuemax="100">
    <div class="bp-progress-bar"></div>
    <span class="sr-only"><span id="stage1-percent-text">{{ meeting.stage1_progress_percent() }}</span>% complete</span>
  </div>
  <span id="stage1-info" class="text-xs text-bp-grey-600 mt-1" role="status" aria-live="polite">
    <span id="stage1-countdown">{{ meeting.stage1_time_remaining() }}</span> left
  </span>
</div>
{% endif %}
{% if meeting.runoff_opens_at and meeting.runoff_closes_at %}
<p class="mb-2">
  Run-off:
  {{ meeting.runoff_opens_at|format_dt }} –
  {{ meeting.runoff_closes_at|format_dt }}
  <a href="{{ runoff_ics_url }}" class="text-bp-blue hover:underline ml-2">Add to calendar</a>
</p>
{% endif %}
{% if meeting.opens_at_stage2 and meeting.closes_at_stage2 %}
<p class="mb-4">
  Stage 2:
  {{ meeting.opens_at_stage2|format_dt }} –
  {{ meeting.closes_at_stage2|format_dt }}
  <a href="{{ stage2_ics_url }}" class="text-bp-blue hover:underline ml-2">Add to calendar</a>
</p>
<div class="mb-6">
  <div id="stage2-progress" class="bp-progress" data-progress-open="{{ meeting.opens_at_stage2.isoformat() }}Z" data-progress-close="{{ meeting.closes_at_stage2.isoformat() }}Z" role="progressbar" aria-valuemin="0" aria-valuemax="100">
    <div class="bp-progress-bar"></div>
    <span class="sr-only"><span id="stage2-percent-text">{{ meeting.stage2_progress_percent() }}</span>% complete</span>
  </div>
  <span id="stage2-info" class="text-xs text-bp-grey-600 mt-1" role="status" aria-live="polite">
    <span id="stage2-countdown">{{ meeting.stage2_time_remaining() }}</span> left
  </span>
</div>
{% endif %}
{% if files %}
<div class="mb-4">
  <h2 class="font-semibold mb-2">Documents</h2>
  <ul class="list-disc pl-5">
  {% for f in files %}
    <li class="mb-1">
      <a href="{{ url_for('main.public_meeting_file', meeting_id=meeting.id, file_id=f.id) }}" class="text-bp-blue hover:underline" download>{{ f.title }}</a>
      {% if f.description %}<p class="text-sm text-bp-grey-700">{{ f.description }}</p>{% endif %}
    </li>
  {% endfor %}
  </ul>
</div>
{% endif %}
<button class="bp-btn-secondary mb-4" data-modal-target="resend-modal">Resend Voting Email</button>
<dialog id="resend-modal" class="bp-card w-full max-w-md" role="dialog" aria-labelledby="resend-title">
  <h2 id="resend-title" class="font-bold mb-2">Request Voting Email</h2>
  <div id="resend-modal-content" hx-target="this" hx-swap="outerHTML">
    {% include 'resend_modal_content.html' %}
  </div>
  <button class="bp-btn-secondary mt-4" data-close-modal>Close</button>
</dialog>
<script src="{{ url_for('static', filename='js/stage_progress.js') }}"></script>
{% endblock %}
