{% extends 'base.html' %}
{% block content %}
<h1 class="font-bold text-bp-blue mb-4">Meetings</h1>

<form class="mb-4 bp-card bp-form"
      hx-get="{{ url_for('meetings.list_meetings') }}"
      hx-target="#meeting-table-body"
      hx-trigger="keyup changed delay:300ms"
      hx-push-url="true">
  <label for="q" class="sr-only">Search meetings</label>
  <input id="q" name="q" type="text" value="{{ q or '' }}" placeholder="Search meetings..." class="border p-3 rounded w-full">
</form>

<div class="bp-card mb-4">
  <table class="bp-table">
    <thead class="bg-bp-grey-50">
      <tr>
        <th scope="col" class="text-left p-2">
          <a hx-get="{{ url_for('meetings.list_meetings', sort='title', direction='desc' if direction=='asc' and sort=='title' else 'asc', q=q) }}"
             hx-target="#meeting-table-body" hx-push-url="true" class="hover:underline">Title</a>
        </th>
        <th scope="col" class="text-left p-2">
          <a hx-get="{{ url_for('meetings.list_meetings', sort='type', direction='desc' if direction=='asc' and sort=='type' else 'asc', q=q) }}"
             hx-target="#meeting-table-body" hx-push-url="true" class="hover:underline">Type</a>
        </th>
        <th scope="col" class="text-left p-2">
          <a hx-get="{{ url_for('meetings.list_meetings', sort='status', direction='desc' if direction=='asc' and sort=='status' else 'asc', q=q) }}"
             hx-target="#meeting-table-body" hx-push-url="true" class="hover:underline">Status</a>
        </th>
      </tr>
    </thead>
    <tbody id="meeting-table-body">
      {% include 'meetings/_meeting_rows.html' %}
    </tbody>
  </table>
</div>
{% if pagination.pages > 1 %}
<nav id="meeting-pagination" aria-label="Pagination" class="mt-4">
  <ul class="bp-pagination">
    {% if pagination.has_prev %}
    <li>
      <a href="{{ url_for('meetings.list_meetings', page=pagination.prev_num, q=q, sort=sort, direction=direction) }}" aria-label="Previous">&laquo;</a>
    </li>
    {% else %}
    <li><span class="bp-disabled">&laquo;</span></li>
    {% endif %}
    {% for p in pagination.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
      {% if p %}
        {% if p == pagination.page %}
        <li><span class="bp-current-page">{{ p }}</span></li>
        {% else %}
        <li><a href="{{ url_for('meetings.list_meetings', page=p, q=q, sort=sort, direction=direction) }}">{{ p }}</a></li>
        {% endif %}
      {% else %}
        <li><span>&hellip;</span></li>
      {% endif %}
    {% endfor %}
    {% if pagination.has_next %}
    <li>
      <a href="{{ url_for('meetings.list_meetings', page=pagination.next_num, q=q, sort=sort, direction=direction) }}" aria-label="Next">&raquo;</a>
    </li>
    {% else %}
    <li><span class="bp-disabled">&raquo;</span></li>
    {% endif %}
  </ul>
</nav>
{% endif %}
<a href="{{ url_for('meetings.create_meeting') }}" class="bp-btn-primary mt-4">Create Meeting</a>
{% endblock %}
