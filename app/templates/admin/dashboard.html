{% extends 'base.html' %}
{% from '_macros.html' import breadcrumbs %}
{% block content %}
<div class="max-w-7xl mx-auto">
  {{ breadcrumbs([('Dashboard', url_for('admin.dashboard'))]) }}
  
  <!-- Header Section -->
  <div class="mb-8">
    <h1 class="text-3xl font-bold text-bp-grey-900 mb-2">Admin Dashboard</h1>
    <p class="text-bp-grey-600 text-lg">Welcome to {{ setting('site_title', 'VoteBuddy') }} administration.</p>
  </div>
  
  <!-- Quick Actions -->
  <div class="flex flex-wrap gap-4 mb-12">
    <a href="{{ url_for('admin.list_users') }}" class="bp-btn-primary bp-btn-icon">
      <img src="{{ url_for('static', filename='icons/group_30dp_FFFFFF_FILL0_wght400_GRAD0_opsz24.svg') }}" alt="" class="bp-icon w-5 h-5">
      <span>Manage Users</span>
    </a>
    <a href="{{ url_for('admin.list_objections') }}" class="bp-btn-secondary bp-btn-icon">
      <img src="{{ url_for('static', filename='icons/person_raised_hand_30dp_000000_FILL0_wght400_GRAD0_opsz24.svg') }}" alt="" class="bp-icon w-5 h-5">
      <span>View Objections</span>
    </a>
  </div>
  
  <!-- My Meetings Section -->
  <div class="mb-8">
    <h2 class="text-2xl font-bold text-bp-grey-900 mb-6 flex items-center gap-2">
      <img src="{{ url_for('static', filename='icons/calendar_today_30dp_000000_FILL0_wght400_GRAD0_opsz24.svg') }}" alt="" class="bp-icon text-bp-blue w-6 h-6">
      My Meetings
    </h2>
    
    {% if meetings %}
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {% for meeting in meetings %}
      <div class="bp-card hover:shadow-xl transition-all">
        <!-- Quorum Alert -->
        {% if meeting.status != 'Completed' %}
        <div class="bp-alert bp-alert-warning mb-4">
          <svg class="bp-icon flex-shrink-0" viewBox="0 0 24 24">
            <path d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor" fill="none"/>
          </svg>
          <div>
            <div class="font-semibold">Quorum: {{ '%.1f'|format(meeting.quorum_percentage()) }}%</div>
            <div class="text-sm">Stage 1 closes in {{ meeting.stage1_time_remaining() }}</div>
          </div>
        </div>
        {% endif %}
        
        <!-- Progress Bar -->
        {% if meeting.status != 'Completed' %}
        <div class="mb-4">
          <div class="bp-progress" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="{{ meeting.stage1_progress_percent() }}">
            <div class="bp-progress-bar" style="width: {{ meeting.stage1_progress_percent() }}%"></div>
          </div>
          <span class="text-xs text-bp-grey-600 mt-1">{{ meeting.stage1_progress_percent() }}% voting window elapsed</span>
        </div>
        {% endif %}
        
        <!-- Meeting Info -->
        <h3 class="text-xl font-bold text-bp-grey-900 mb-2">{{ meeting.title }}</h3>
        <p class="text-bp-grey-600 mb-3">
          <img src="{{ url_for('static', filename='icons/calendar_today_30dp_000000_FILL0_wght400_GRAD0_opsz24.svg') }}" alt="" class="bp-icon inline w-4 h-4 mr-1">
          Notice given {{ meeting.notice_date.strftime('%B %d, %Y') if meeting.notice_date else 'N/A' }}
        </p>
        
        <!-- Status Badge -->
        <div class="flex items-center justify-between mb-4">
          {% if meeting.status == 'Completed' %}
          <span class="bp-badge bp-badge-success">
            <svg class="bp-icon w-4 h-4 mr-1" viewBox="0 0 24 24">
              <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor" fill="none"/>
            </svg>
            Completed
          </span>
          {% else %}
          <span class="bp-badge">{{ meeting.status or 'Draft' }}</span>
          {% endif %}
          
          {% if meeting.status != 'Completed' %}
          <span class="bp-badge bp-badge-secondary">
            <img src="{{ url_for('static', filename='icons/clock_loader_40_30dp_FFFFFF_FILL0_wght400_GRAD0_opsz24.svg') }}" alt="" class="bp-icon w-4 h-4 mr-1">
            Next reminder in {{ meeting.hours_until_next_reminder() }}h
          </span>
          {% endif %}
        </div>
        
        <!-- Actions -->
        <div class="pt-4 border-t border-bp-grey-100 flex gap-2">
          <a href="{{ url_for('meetings.list_motions', meeting_id=meeting.id) }}" class="bp-btn-secondary text-sm flex-1">
            View Details
          </a>
          <form action="{{ url_for('admin.toggle_public_results', meeting_id=meeting.id) }}" method="post" class="flex-1">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <button type="submit" class="bp-btn-secondary text-sm w-full">
              {{ 'Hide Results' if meeting.public_results else 'Show Results' }}
            </button>
          </form>
          <form action="{{ url_for('admin.toggle_results_doc', meeting_id=meeting.id) }}" method="post" class="flex-1">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <button type="submit" class="bp-btn-secondary text-sm w-full">
              {{ 'Unpublish Doc' if meeting.results_doc_published else 'Publish Doc' }}
            </button>
          </form>
        </div>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <div class="text-center py-12 px-4 bp-card">
      <img src="{{ url_for('static', filename='icons/calendar_today_30dp_000000_FILL0_wght400_GRAD0_opsz24.svg') }}" alt="" class="bp-icon w-16 h-16 mx-auto mb-4 text-bp-grey-400">
      <h3 class="text-lg font-semibold text-bp-grey-700 mb-2">No meetings yet</h3>
      <p class="text-bp-grey-600 mb-4">Get started by creating your first meeting.</p>
      <a href="{{ url_for('meetings.create_meeting') }}" class="bp-btn-primary">
        Create First Meeting
      </a>
    </div>
    {% endif %}
  </div>
  
  <!-- Floating Action Button -->
  {% if meetings %}
  <a href="{{ url_for('meetings.create_meeting') }}" class="fixed bottom-8 right-8 bp-btn-primary rounded-full px-4 py-3 flex items-center gap-2 shadow-xl hover:shadow-2xl transition-all">
    <svg class="bp-icon w-5 h-5" viewBox="0 0 24 24">
      <path d="M12 4v16m8-8H4" stroke="currentColor" fill="none" stroke-width="3"/>
    </svg>
    <span class="text-sm font-medium">New Meeting</span>
  </a>
  {% endif %}
</div>
{% endblock %}
