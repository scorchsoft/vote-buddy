{% extends 'base.html' %}
{% from '_macros.html' import breadcrumbs %}
{% block content %}
{{ breadcrumbs([('Dashboard', url_for('admin.dashboard'))]) }}
<div class="bp-card space-y-4">
  <h1 class="font-bold text-bp-blue">Admin Dashboard</h1>
  <p>Welcome to {{ setting('site_title', 'VoteBuddy') }} administration.</p>
  <a href="{{ url_for('admin.list_users') }}" class="bp-btn-primary">Manage Users</a>
  <a href="{{ url_for('admin.list_objections') }}" class="bp-btn-secondary ml-2">View Objections</a>
</div>
<h2 class="font-bold text-bp-blue mb-4">My Meetings</h2>
<div class="bp-card-grid mb-12">
  {% for meeting in meetings %}
  <div class="bp-card">
    <div class="bp-alert-warning mb-2">
      Quorum: {{ '%.1f'|format(meeting.quorum_percentage()) }}% â€“
      Stage 1 closes in {{ meeting.stage1_time_remaining() }}
    </div>
    <div class="bp-progress" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="{{ meeting.stage1_progress_percent() }}">
      <div class="bp-progress-bar" style="width: {{ meeting.stage1_progress_percent() }}%"></div>
      <span class="sr-only">{{ meeting.stage1_progress_percent() }}% complete</span>
    </div>
    <h3 class="font-semibold mb-1">{{ meeting.title }}</h3>
    <p class="text-sm mb-1">Notice given {{ meeting.notice_date.strftime('%Y-%m-%d') if meeting.notice_date else 'N/A' }}</p>
    {% if meeting.status == 'Completed' %}
    <p class="bp-alert-success text-sm mb-1">Completed</p>
    {% else %}
    <p class="text-sm mb-1">{{ meeting.status or 'Draft' }}</p>
    {% endif %}
    <span class="bp-badge">Next reminder in {{ meeting.hours_until_next_reminder() }}h</span>
    <form action="{{ url_for('admin.toggle_public_results', meeting_id=meeting.id) }}" method="post" class="inline-block mt-2">
      {{ csrf_token() }}
      <button type="submit" class="bp-btn-secondary text-sm">
        {{ 'Hide Results' if meeting.public_results else 'Show Results' }}
      </button>
    </form>
  </div>
  {% else %}
  <p>No meetings available.</p>
  {% endfor %}
</div>
<a href="{{ url_for('meetings.create_meeting') }}" class="bp-btn-primary bp-float-btn">Create Meeting</a>
{% endblock %}
