{% extends 'base.html' %}
{% from '_macros.html' import breadcrumbs %}
{% block content %}
{{ breadcrumbs([('Dashboard', url_for('admin.dashboard')), ('Settings', url_for('admin.manage_settings'))]) }}
<div class="bp-card max-w-4xl mx-auto space-y-4">
  <h1 class="font-bold text-bp-blue">Application Settings</h1>
  <form method="post" enctype="multipart/form-data" hx-boost="false">
    {{ form.hidden_tag() }}
    {% if form.errors %}
    <div class="mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded">
      <strong>Form validation errors:</strong>
      <ul>
        {% for field_name, errors in form.errors.items() %}
          {% for error in errors %}
            <li>{{ field_name }}: {{ error }}</li>
          {% endfor %}
        {% endfor %}
      </ul>
    </div>
    {% endif %}
    <div class="mb-4">
      {{ form.site_title.label(class='block mb-1') }}
      {{ form.site_title(class='bp-input w-full') }}
      {% if form.site_title.errors %}
        {% for error in form.site_title.errors %}
          <div class="text-red-600 text-sm mt-1">{{ error }}</div>
        {% endfor %}
      {% endif %}
    </div>
    <div class="mb-4">
      {{ form.site_logo.label(class='block mb-1') }}
      <div class="flex gap-2">
        {{ form.site_logo(class='bp-input w-full') }}
        <button type="submit"
                formaction="{{ url_for('admin.reset_setting', key='site_logo') }}"
                formmethod="post"
                class="text-sm underline">Clear</button>
      </div>
      {{ form.logo_file(class='bp-input w-full mt-2') }}
    </div>
    <div class="mb-4">
      {{ form.from_email.label(class='block mb-1') }}
      <div class="flex gap-2">
        {{ form.from_email(class='bp-input w-full') }}
        <button type="submit"
                formaction="{{ url_for('admin.reset_setting', key='from_email') }}"
                formmethod="post"
                class="text-sm underline">Reset default</button>
      </div>
    </div>
    <div class="mb-4">
      {{ form.runoff_extension_minutes.label(class='block mb-1') }}
      <div class="flex gap-2">
        {{ form.runoff_extension_minutes(class='bp-input w-full') }}
        <button type="submit"
                formaction="{{ url_for('admin.reset_setting', key='runoff_extension_minutes') }}"
                formmethod="post"
                class="text-sm underline">Reset default</button>
      </div>
      {% if form.runoff_extension_minutes.errors %}
        {% for error in form.runoff_extension_minutes.errors %}
          <div class="text-red-600 text-sm mt-1">{{ error }}</div>
        {% endfor %}
      {% endif %}
    </div>
    <div class="mb-4">
      {{ form.reminder_hours_before_close.label(class='block mb-1') }}
      <div class="flex gap-2">
        {{ form.reminder_hours_before_close(class='bp-input w-full') }}
        <button type="submit"
                formaction="{{ url_for('admin.reset_setting', key='reminder_hours_before_close') }}"
                formmethod="post"
                class="text-sm underline">Reset default</button>
      </div>
    </div>
    <div class="mb-4">
      {{ form.reminder_cooldown_hours.label(class='block mb-1') }}
      <div class="flex gap-2">
        {{ form.reminder_cooldown_hours(class='bp-input w-full') }}
        <button type="submit"
                formaction="{{ url_for('admin.reset_setting', key='reminder_cooldown_hours') }}"
                formmethod="post"
                class="text-sm underline">Reset default</button>
      </div>
    </div>
    <div class="mb-4">
      {{ form.stage2_reminder_hours_before_close.label(class='block mb-1') }}
      <div class="flex gap-2">
        {{ form.stage2_reminder_hours_before_close(class='bp-input w-full') }}
        <button type="submit"
                formaction="{{ url_for('admin.reset_setting', key='stage2_reminder_hours_before_close') }}"
                formmethod="post"
                class="text-sm underline">Reset default</button>
      </div>
    </div>
    <div class="mb-4">
      {{ form.stage2_reminder_cooldown_hours.label(class='block mb-1') }}
      <div class="flex gap-2">
        {{ form.stage2_reminder_cooldown_hours(class='bp-input w-full') }}
        <button type="submit"
                formaction="{{ url_for('admin.reset_setting', key='stage2_reminder_cooldown_hours') }}"
                formmethod="post"
                class="text-sm underline">Reset default</button>
      </div>
    </div>
    <div class="mb-4">
      {{ form.reminder_template.label(class='block mb-1') }}
      <div class="flex gap-2">
        {{ form.reminder_template(class='bp-input w-full') }}
        <button type="submit"
                formaction="{{ url_for('admin.reset_setting', key='reminder_template') }}"
                formmethod="post"
                class="text-sm underline">Reset default</button>
      </div>
    </div>
    <div class="mb-4">
      {{ form.tie_break_decisions.label(class='block mb-1') }}
      <div class="flex gap-2">
        {{ form.tie_break_decisions(class='bp-input w-full h-32') }}
        <button type="submit"
                formaction="{{ url_for('admin.reset_setting', key='tie_break_decisions') }}"
                formmethod="post"
                class="text-sm underline">Reset default</button>
      </div>
    </div>
    <div class="mb-4">
      <div class="flex justify-between items-center mb-1">
        {{ form.clerical_text.label() }}
        <button type="submit"
                formaction="{{ url_for('admin.reset_setting', key='clerical_text') }}"
                formmethod="post"
                class="text-sm underline">Reset default</button>
      </div>
      {{ form.clerical_text(class='bp-input w-full h-32') }}
    </div>
    <div class="mb-4">
      <div class="flex justify-between items-center mb-1">
        {{ form.move_text.label() }}
        <button type="submit"
                formaction="{{ url_for('admin.reset_setting', key='move_text') }}"
                formmethod="post"
                class="text-sm underline">Reset default</button>
      </div>
      {{ form.move_text(class='bp-input w-full h-32') }}
    </div>
    <div class="mb-4">
      <div class="flex justify-between items-center mb-1">
        {{ form.final_message.label() }}
        <button type="submit"
                formaction="{{ url_for('admin.reset_setting', key='final_message') }}"
                formmethod="post"
                class="text-sm underline">Reset default</button>
      </div>
      {{ form.final_message(class='bp-input w-full h-32') }}
    </div>
    <div class="mb-4">
      {{ form.contact_url.label(class='block mb-1') }}
      {{ form.contact_url(class='bp-input w-full') }}
    </div>
    <div class="mb-4">
      {{ form.manual_email_mode() }} {{ form.manual_email_mode.label }}
    </div>
    {{ form.submit(class='bp-btn-primary') }}
  </form>
</div>
<link rel="stylesheet" href="{{ url_for('static', filename='css/easymde.min.css') }}">
<script src="{{ url_for('static', filename='js/easymde.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/markdown_editor.js') }}"></script>
{% endblock %}
